# app.py
import streamlit as st
from openai import OpenAI

# âœ… ìµœì‹  openai ë¼ì´ë¸ŒëŸ¬ë¦¬ ë°©ì‹
client = OpenAI(api_key=st.secrets["OPENAI_API_KEY"])

st.set_page_config(page_title="ë‚˜ë§Œì˜ GPT-4 ì±—ë´‡", layout="centered")
st.title("ğŸ¤– ë‚˜ë§Œì˜ GPT-4 ì±—ë´‡")

# ì„¸ì…˜ ìƒíƒœ ì´ˆê¸°í™”
if "messages" not in st.session_state:
    st.session_state.messages = [
        {
            "role": "system",
            "content": """
ë‹¹ì‹ ì€ ë™ì›ê±´ì„¤ì‚°ì—…ì˜ ì§€ì‹ ìˆœí™˜ ì‹œìŠ¤í…œì— íƒ‘ì¬ëœ GPT ê¸°ë°˜ ì–´ì‹œìŠ¤í„´íŠ¸ì…ë‹ˆë‹¤.

ì´ ì‹œìŠ¤í…œì€ ì‹¤ì‹œê°„ìœ¼ë¡œ íšŒì‚¬ ë‚´ë¶€ì— ì¶•ì ë˜ëŠ” í•˜ìì‚¬ë¡€, VEì‚¬ë¡€, ë¯¼ì›ì‚¬ë¡€, ê¸°íƒ€ ê±´ì„¤ ê´€ë ¨ ì´ìŠˆë“¤ì„ ì§ì›ë“¤ì´ ë¹ ë¥´ê²Œ ê²€ìƒ‰í•˜ê³  ì´í•´í•  ìˆ˜ ìˆë„ë¡ ë•ëŠ” ê²ƒì„ ëª©ì ìœ¼ë¡œ í•©ë‹ˆë‹¤.

ëª¨ë“  ì •ë³´ëŠ” Google Sheetsì— ì €ì¥ëœ ê³µì‹ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•˜ë©°, ì‚¬ìš©ìì˜ ì§ˆë¬¸ì´ ì €ì¥ëœ ë°ì´í„°ì™€ ê´€ë ¨ëœ ê²½ìš°ì—ëŠ” í•´ë‹¹ ì‹œíŠ¸ë¥¼ íƒìƒ‰í•˜ì—¬ ê·¸ì— ë§ëŠ” ë‚´ìš©ì„ ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”í˜•íƒœ ë˜ëŠ” ìš”ì²­í•œ í˜•ì‹ìœ¼ë¡œ ìš”ì•½, ë¶„ì„, ì œê³µí•©ë‹ˆë‹¤.

ë‹¨, ì €ì¥ëœ ì‹œíŠ¸ ë‚´ì— ê´€ë ¨ëœ ì •ë³´ê°€ ì—†ê±°ë‚˜ ì°¾ì„ ìˆ˜ ì—†ëŠ” ê²½ìš°ì—ëŠ” í—ˆìœ„ë¡œ ë‹µë³€í•˜ì§€ ë§ê³ , ì •ì§í•˜ê²Œ â€œì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤â€, â€œì •ë³´ê°€ ë“±ë¡ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤â€ ë“±ì˜ í‘œí˜„ìœ¼ë¡œ ì‘ë‹µí•´ ì£¼ì„¸ìš”.

ë˜í•œ ë³¸ ì‹œìŠ¤í…œì€ ê±´ì„¤ ê´€ë ¨ ì§€ì‹ ê³µìœ ë¥¼ ìœ„í•œ ì „ìš© ë„êµ¬ì…ë‹ˆë‹¤. í•˜ìì‚¬ë¡€, VEì‚¬ë¡€, ë¯¼ì›ì‚¬ë¡€, ê³µì • ì´ìŠˆ ë“±ê³¼ ë¬´ê´€í•œ ì§ˆë¬¸ì´ ì…ë ¥ëœ ê²½ìš°ì—ëŠ” ì •ì¤‘í•˜ê²Œ í•´ë‹¹ ì£¼ì œì— ëŒ€í•œ ì‘ë‹µì´ ë¶ˆê°€ëŠ¥í•¨ì„ ì•ˆë‚´í•˜ê³ , ì‚¬ìš© ëª©ì ì— ë§ëŠ” ì§ˆë¬¸ì„ ìœ ë„í•´ ì£¼ì„¸ìš”.

ì–¸ì œë‚˜ ì¹œì ˆí•˜ê³  ì •í™•í•˜ë©°, íšŒì‚¬ ë‚´ë¶€ ì •ë³´ë¥¼ ì‹ ì¤‘í•˜ê²Œ ì „ë‹¬í•˜ëŠ” íƒœë„ë¥¼ ìœ ì§€í•´ì•¼ í•©ë‹ˆë‹¤.
"""
        }
    ]


# ì‚¬ìš©ì ì…ë ¥ ë°›ê¸°
user_input = st.chat_input("ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”.")
if user_input:
    st.session_state.messages.append({"role": "user", "content": user_input})

    with st.spinner("GPTê°€ ë‹µë³€ì„ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤..."):
        try:
            response = client.chat.completions.create(
                model="gpt-3.5-turbo",
                messages=st.session_state.messages
            )
            reply = response.choices[0].message.content
            st.session_state.messages.append({"role": "assistant", "content": reply})
        except Exception as e:
            st.error(f"âŒ ì˜¤ë¥˜ ë°œìƒ: {e}")

# ì±„íŒ… ì¶œë ¥
for msg in st.session_state.messages[1:]:
    with st.chat_message(msg["role"]):
        st.markdown(msg["content"])
